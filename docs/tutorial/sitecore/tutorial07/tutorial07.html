---
layout: DocsLayout
title: Tutorial 7 - Using Queries
---

{% include pageheader.html %}
<p>
    This tutorial will show you how you can enhance you models using the queries.
</p>
<p>
    We haven't yet got a page that lists all the news articles in our news section. We will create a news landing page
    that lists all the news articles in our news section.
</p>
<p>
    I have changed the news section to store stories in a year/month structure:
</p>
<img src="tutorial07.items.png" class="img-polaroid"/>
<p>
    We will use the query to select only the news articles and to ignore the folders. The model for the news landing page
    looks like this:
</p>
<pre class="github cs"  ref="gh-pages">
using System.Collections.Generic;
using Glass.Mapper.Sc.Configuration.Attributes;
using Glass.Mapper.Sites.Sc.Models.Content;
using Glass.Mapper.Sites.Sc.Models.Misc;

namespace Glass.Mapper.Sites.Sc.Models.Landing
{
    [SitecoreType(AutoMap = true)]
    public class NewsLanding : ContentBase
    {
        [SitecoreQuery("./*/*/*[@@templatename='NewsArticle']", IsRelative = true)]
        public virtual IEnumerable&lt;NewsArticle&gt; Articles { get; set; }
    }
}
</pre>
<p>
    The IsRelative at the end is important, it tells Glass.Mapper to execute the query relative to the item the class represents, i.e.
    the news landing page rather than from the Sitecore root. Queries are executed lazily and therefore only populated when the property is called.
</p>
<p>
    When using a query the target property can be an enumerable, like our property, or a single class. If a single class is 
    used the first item returned by the query is mapped.
</p>
<p>
    Now we just need to create our landing page markup, the code behind is below:
</p>
<pre class="github cs"  ref="gh-pages">
using Glass.Mapper.Sc.Web.Ui;
using Glass.Mapper.Sites.Sc.Models.Landing;

namespace Glass.Mapper.Sites.Sc.layouts.Site.Landing
{
    public partial class NewsLandingSublayout : GlassUserControl&lt;NewsLanding&gt;
    {
    }
}


</pre>
<p>
    And the the ASCX:
</p>
<pre class="github cs"  ref="gh-pages">
&lt;%@ Control Language="C#" AutoEventWireup="true" CodeBehind="NewsLandingSublayout.ascx.cs" Inherits="Glass.Mapper.Sites.Sc.layouts.Site.Landing.NewsLandingSublayout" %&gt;
&lt;div class="page-header"&gt;
    &lt;h1&gt;&lt;%=Editable(x=&gt; x.Title) %&gt; &lt;small&gt;&lt;/small&gt;&lt;/h1&gt;
&lt;/div&gt;
&lt;ul class="thumbnails"&gt;
    &lt;% foreach (var article in Model.Articles.OrderBy(x=&gt;x.Date))
       { %&gt;
    &lt;li&gt;
        &lt;div class="span1"&gt;&lt;/div&gt;
        &lt;div class="span3"&gt;
            &lt;a title="&lt;%=article.Title %&gt;" class="thumbnail"&gt;
                &lt;img src="&lt;%=article.FeaturedImage.Src%&gt;"  /&gt;
            &lt;/a&gt;
        &lt;/div&gt;
        &lt;div class="span7"&gt;
            &lt;div class="row"&gt;
                &lt;div class="span5"&gt;
                    &lt;h3&gt;&lt;a href="&lt;%=article.Url %&gt;"&gt;&lt;%=article.Title %&gt;&lt;/a&gt;&lt;/h3&gt;
                &lt;/div&gt;
                &lt;div class="span2"&gt;
                    &lt;p&gt;&lt;%=article.Date.ToString("dd MMM yyyy") %&gt;&lt;/p&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class="row"&gt;
                &lt;p  class="span7"&gt;
                    &lt;%=article.Abstract %&gt;
                &lt;/p&gt;
            &lt;/div&gt;
            &lt;div class="row"&gt;
                &lt;div class="span7"&gt;
                    &lt;a title="&lt;%=article.Title %&gt;" class="pull-right"&gt;Read More&lt;/a&gt;
                &lt;/div&gt;
            &lt;/div&gt;

        &lt;/div&gt;
        &lt;div class="span1"&gt;&lt;/div&gt;
    &lt;/li&gt;
    &lt;% } %&gt;
&lt;/ul&gt;
</pre>
<p>
    If we compile and navigate to the landing page we should see the following result:
</p>
<img src="tutorial07.webpage.png" class="img-polaroid"/>
<p>
    This tutorial has shown you how you can use queries on your models to load items from across you Sitecore solution.
</p>
<p>
    <a href="../tutorial08/tutorial08.html">Tutorial 8 - Fluent configuration</a>
</p>


